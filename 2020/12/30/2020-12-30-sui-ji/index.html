<!DOCTYPE html>
<html>
<head>
  <title>
    2020-12-30随记 - HexoTest
  </title>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  
  <link rel="shortcut icon" href="/favicon.ico" />
  

  
<link rel="stylesheet" href="/css/utils/clear.css">

  
<link rel="stylesheet" href="/css/style.css">


  <link href="https://google-fonts.mirrors.sjtug.sjtu.edu.cn/css2?family=Noto+Sans+SC:wght@100;300;400;500;700;900&display=swap" rel="stylesheet">

  <script src="https://cdn.bootcss.com/jquery/3.4.1/jquery.min.js"></script>
  <link href="https://cdn.bootcss.com/highlight.js/9.15.6/styles/default.min.css" rel="stylesheet">
<meta name="generator" content="Hexo 5.3.0"></head>

<body>
  <div class="title">
  <img class="title_img" src="/images/icon.png"/><br>
  <p id="site_title">&nbspHexoTest&nbsp</p>
</div>

  <div class="navi">
    <a id="navi_item" href="/#" class="menu-item-link">主页</a>
    <a id="navi_item" href="/tags" class="menu-item-link">标签</a>
    <a id="navi_item" href="/about" class="menu-item-link">关于</a>
    <a id="navi_item" href="/search" class="menu-item-link">搜索</a>
    
        <a id="navi_item" href="/friendlink" class="menu-item-link">友链</a>
    
</div>

<hr/>


  <div class="main">
    
<link rel="stylesheet" href="/css/post.css">

<post>

  <div class="post_title">
    2020-12-30随记
  </div>

  <br/><br/>

  
  <link rel="stylesheet" href="//cdn.jsdelivr.net/gh/highlightjs/cdn-release@10.1.2/build/styles/xcode.min.css">
  <script src="/js/highlight.min.js"></script>
  <script>hljs.initHighlightingOnLoad();</script>
  

  <div id="post_content">
    <h2 id="待办"><a href="#待办" class="headerlink" title="待办"></a>待办</h2><p>2020-12-30 日,下午15点创建</p>
<h3 id="问题"><a href="#问题" class="headerlink" title="问题"></a>问题</h3><ul>
<li>说明,安装 servlet3.0  再springboot 项目中引入Filter ,指定了urlPattern 拦截的url,但是经常会有未指定的url被拦截器拦截,例如:qp_new 项目中MemberLoginFilter 拦截了 TestController 类的方法</li>
<li>redis 加载的不同的原因,探明,再未按照标准格式引入redis 的时候,经常会报连接异常,经查找发现 springboot 的redis 管理包,会默认通过 RedisConnectionFactory 对象来管理所以redis 连接;但是正常配置的好像不需要手动声明此类的创建,怀疑可能是正常配置后,springboot 会自动生成该类</li>
</ul>
<h3 id="完成度"><a href="#完成度" class="headerlink" title="完成度"></a>完成度</h3><ul>
<li><ol>
<li><p>第一个问题,springboot 中配置 Servlet 3.0 注解配置(加上 @Component) Filter的问题,经测试发现,当使用这种方法配置的时候,springboot 加载时该 Filter 配置的 urlPattern 会统一变成 urlPattern = “/*”, debug 路径:</p>
<p>再某个filter 中断点 - &gt; 进入 FilterChain 链接,找到被拦截的filter -&gt; content -&gt; filterMaps 是一个数组 ,可以找到该 Filter 对应的 拦截 url(这个对象总是包含当前上下文中注册的所有Filter 对象的 拦截 url 的键值对)</p>
</li>
<li><p>经过测试发现,单纯 @Component 注解就是将 类加载到 springboot 的上下文中,除了处理依赖关系 @Autowired等注解外,不会对其他参数进行处理,更不会处理 @WebFilter(Servlet3.0 的注解之类的定义);</p>
<p>还是需要再启动类上加 @ServletComponentScan 注解来扫描项目中的 Servlet3.0 注解配置类,由这个注解来加载这些对象</p>
</li>
</ol>
<p><strong>说明</strong>:(用时大约1个小时, <strong>对比分析法</strong>,通过上面描述的创建 过滤器 Filter, 和 通过 配置类中定义@Bean ,通过 FilterRegistrationBean 对象创建来加载Filter 两者进行对比来发现,难点就是查询 debug 对象,想看 哪个地方设置 Filter 和 拦截的url 的关系,找了很长时间)</p>
</li>
<li><ol>
<li><p>第二个问题,经过测试发现再按照 springboot 原本的配置项配置redis 的连接参数时,并未像我再qp_new 中自定义配置项,自定义加载到 springboot 中那样 ,没有进入 (org.springframework.boot.autoconfigure.data.redis.JedisConnectionConfiguration#redisConnectionFactory) 这个方法,该方法外有一个注解判断 @ConditionalOnMissingBean,如下,说明此时程序中已经存在了 RedisConnectionFactory 对象</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F; spring-boot-starter-data-redis 版本 2.2.5</span><br><span class="line">@Bean</span><br><span class="line">@ConditionalOnMissingBean(RedisConnectionFactory.class)</span><br><span class="line">JedisConnectionFactory redisConnectionFactory(</span><br><span class="line">		ObjectProvider&lt;JedisClientConfigurationBuilderCustomizer&gt; builderCustomizers) throws UnknownHostException &#123;</span><br><span class="line">	return createJedisConnectionFactory(builderCustomizers);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li><p>通过<strong>引入分析法</strong>(当发现一个类不知道是怎么创建的,且有很多实现的类的时候,我通常就再其他类中引入该类 @Autowired,通过debug 观察该类, this 对象就包含当前引入的对象), 发现按照springboot(springboot2.1.0版本) 自定义的方式配置 redis 配置 (他会自动去创建 LettuceConnectionFactory 另一种 redis 连接客户端,而不是 JedisConnectionFactory )</p>
<p>过程:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">@Bean</span><br><span class="line">	@ConditionalOnMissingBean(RedisConnectionFactory.class)</span><br><span class="line">	public LettuceConnectionFactory redisConnectionFactory(</span><br><span class="line">			ClientResources clientResources) throws UnknownHostException &#123;</span><br><span class="line">		LettuceClientConfiguration clientConfig &#x3D; getLettuceClientConfiguration(</span><br><span class="line">				clientResources, this.properties.getLettuce().getPool());</span><br><span class="line">		return createLettuceConnectionFactory(clientConfig);</span><br><span class="line">	&#125;</span><br></pre></td></tr></table></figure>
<p>同样是通过 @Configuration  和 @Bean 注解来自动装配 LettuceConnectionFactory 对象,通过 createLettuceConnectionFactory 方法来判断 redis 的类型是 集群的还是主从的还是单机的,然后通过</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">org.springframework.boot.autoconfigure.data.redisRedisProperties &#x2F;&#x2F;类来获取配置的配置</span><br><span class="line"></span><br><span class="line">@ConfigurationProperties(prefix &#x3D; &quot;spring.redis&quot;)</span><br><span class="line">public class RedisProperties &#123;</span><br><span class="line">&#x2F;&#x2F;...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>该类通过@ConfigurationProperties 来加载配置文件的配置来构造加载到springboot 中</p>
</li>
</ol>
<p><strong>说明</strong>:(主要是通过<strong>对比分析</strong>和<strong>引入观察法</strong>,来查找相关的类的创建过程和详情,来查找头绪,用时大约 半个小时 )</p>
</li>
</ul>
<h3 id="看过"><a href="#看过" class="headerlink" title="看过"></a>看过</h3><p>比较有用的一些知识点</p>
<ul>
<li><p>圈复杂度(关于重构)</p>
</li>
<li><p>CAP 理论(分布式系统设计,参考<a target="_blank" rel="noopener" href="https://www.cnblogs.com/siyuanwai/p/14211166.html">CAP理论</a>)</p>
</li>
</ul>

  </div>

  <br/>

  
    <script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
    <span id="busuanzi_container_site_pv">本文总阅读量：<span id="busuanzi_value_page_pv"></span>次</span>
  
  <br/><br/>


  

  <div class="copyright" >

    <a class="license-image" rel="license noopener" target="_blank" href="http://creativecommons.org/licenses/by
-nc
-sa
/4.0/"><img alt="知识共享许可协议" style="border-width:0" src="https://i.creativecommons.org/l/by
-nc
-sa
/4.0/80x15.png" />
    </a>

      <p>本作品采用
      <a class="license-word-hyper" rel="license noopener" target="_blank" href="http://creativecommons.org/licenses/by
-nc
-sa
/4.0/">
        知识共享署名
-非商业性使用
-相同方式共享
4.0 国际许可协议</a>
      进行许可。</p>
  </div>


  <div id="top">
    <a href="#">▲</a>
    <a href="#footer">▼</a>
</div>

  
  <script defer src="https://commento.pcrab.xyz/js/commento.js"></script>
<div id="commento"></div>
<noscript>Please enable JavaScript to load the comments.</noscript>


</post>

  </div>

  <foot id="footer">
  <hr class="boldline"/>
  <br>

  <p class="center font">
    
      <a target="_blank" rel="noopener" href="https://github.com/pcrab">
  <svg class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg">
   <path class="icon_path" d="M427.392 853.504a61.44 61.44 0 0 1-1.450667 15.530667 92.586667 92.586667 0 0 1-10.965333 27.605333c-15.061333 25.301333-40.661333 42.154667-73.642667 42.154667-77.653333 0-108.117333-38.101333-146.261333-133.504C169.216 740.693333 157.013333 725.461333 128 725.461333v-85.333333c77.653333 0 108.117333 38.101333 146.261333 133.504 25.856 64.597333 38.058667 79.786667 67.072 79.786667 0-12.373333-0.170667-23.296-0.512-38.144-0.853333-34.816-0.938667-41.941333 0.554667-51.2 0.64-20.352 5.888-34.773333 16.384-49.066667-95.232-20.736-159.445333-63.573333-196.309333-132.992l-13.824-32.426667C134.186667 510.848 128 467.072 128 416.426667c0-58.24 17.749333-110.336 50.944-153.856-10.368-41.386667-8.96-91.989333 13.909333-149.077334l7.466667-18.688 19.2-6.101333c2.56-0.853333 5.632-1.578667 9.301333-2.133333 37.290667-5.888 90.325333 8.106667 159.701334 52.48a565.930667 565.930667 0 0 1 127.274666-14.208c38.741333 0 77.226667 3.882667 114.048 11.605333 67.456-42.24 119.04-55.509333 155.306667-49.92 3.626667 0.597333 6.741333 1.322667 9.258667 2.133333l19.285333 6.101334 7.466667 18.773333c20.010667 50.218667 23.424 96.469333 16.128 136.96C875.434667 296.32 896 352.597333 896 416.512c0 53.888-3.84 94.378667-14.933333 133.802667l-11.733334 32.170666c-30.677333 69.333333-98.304 112.64-202.538666 133.248 10.837333 15.018667 15.872 30.250667 15.872 52.394667v42.666667l-0.042667 42.666666a13.013333 13.013333 0 0 0 0.341333 2.730667L682.666667 938.794667c-36.352 0-63.36-17.706667-76.672-45.653334a88.277333 88.277333 0 0 1-8.661334-40.277333v-84.736c0-3.584-0.128-3.797333-8.832-12.501333-23.296-23.296-33.834667-40.874667-33.834666-72.832v-38.613334l38.4-3.84c114.346667-11.52 176.512-43.221333 197.12-89.6l9.6-26.325333c7.68-27.562667 10.88-61.098667 10.88-107.946667 0-49.706667-17.365333-90.837333-50.218667-123.648L742.4 274.773333l7.381333-24.448c6.528-21.717333 8.106667-47.402667 1.152-76.714666a158.634667 158.634667 0 0 0-3.584 0.938666c-22.826667 6.4-51.370667 20.053333-85.76 43.008l-15.658666 10.453334-18.304-4.522667a467.754667 467.754667 0 0 0-111.829334-13.269333c-42.709333 0-84.906667 5.418667-123.946666 16.042666l-19.029334 5.205334-16.256-11.136c-35.541333-24.32-65.109333-38.826667-88.746666-45.568a158.293333 158.293333 0 0 0-4.864-1.28c-8.234667 33.92-4.992 61.781333 3.413333 82.688l9.984 25.088-18.346667 19.797333C228.693333 332.629333 213.333333 370.986667 213.333333 416.512c0 41.685333 4.864 76.202667 13.824 102.229333l11.178667 26.453334c27.904 52.352 87.168 83.84 192.853333 95.146666l38.144 4.096v38.357334c0 32-10.538667 49.536-33.834666 72.832-8.704 8.704-8.832 8.96-8.832 12.501333l-0.725334 7.893333c-0.512 2.56-0.512 9.258667 0.170667 37.205334 0.298667 12.8 0.469333 22.997333 0.554667 33.621333a33.962667 33.962667 0 0 1 0.725333 6.656z"/>
  </svg>
 </a>

    
    
      <a href="mailto:pcrab@mailbox.org">
  <svg class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg">
    <path d="M513.78 602.99c-27.28 0.45-53.79-9.09-74.53-26.83l-65.96-56.64c-15.64-13.37-17.48-36.9-4.1-52.54 13.38-15.65 36.9-17.48 52.54-4.1l65.96 56.64c13.68 11.1 33.27 11.1 46.95 0L881.2 253.08l-708.02-2.61c-20.58 0-37.26-16.69-37.26-37.26s16.68-37.26 37.26-37.26H881.2c41.09-2.36 76.32 29.05 78.67 70.14a74.519 74.519 0 0 1-32.46 65.87L580.86 578.38a111.842 111.842 0 0 1-67.08 24.61z m444.57 133.4V438.28c0-20.58-16.68-37.26-37.26-37.26s-37.26 16.69-37.26 37.26V736.4c0 20.58-16.68 37.26-37.26 37.26h-521.7c-20.58 0-37.26 16.69-37.26 37.26s16.68 37.26 37.26 37.26h521.7c61.72 0.01 111.78-50.05 111.78-111.79zM362.12 363.75c0-20.58-16.68-37.26-37.26-37.26h-223.6c-20.58 0-37.26 16.69-37.26 37.26s16.68 37.26 37.26 37.26h223.59c20.58 0.01 37.27-16.68 37.27-37.26z m0 298.12c0-20.58-16.68-37.26-37.26-37.26h-111.8c-20.58 0-37.26 16.69-37.26 37.26s16.68 37.26 37.26 37.26h111.79c20.58 0 37.27-16.69 37.27-37.26z"/>
  </svg>
</a>

    
    
      <a target="_blank" rel="noopener" href="https://t.me/Pcrab">
  <svg class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg">
    <path d="M834.24 127.872a95.168 95.168 0 0 0-29.856 7.136h-0.128c-9.12 3.616-52.48 21.856-118.4 49.504l-236.224 99.488c-169.504 71.36-336.128 141.632-336.128 141.632l1.984-0.768s-11.488 3.776-23.488 12a64.96 64.96 0 0 0-18.752 18.144c-5.888 8.64-10.624 21.856-8.864 35.52 2.88 23.104 17.856 36.96 28.608 44.608 10.88 7.744 21.248 11.36 21.248 11.36h0.256l156.256 52.64c7.008 22.496 47.616 156 57.376 186.752 5.76 18.368 11.36 29.856 18.368 38.624 3.392 4.48 7.36 8.224 12.128 11.232a35.808 35.808 0 0 0 7.872 3.392l-1.6-0.384c0.48 0.128 0.864 0.512 1.216 0.64 1.28 0.352 2.144 0.48 3.776 0.736 24.736 7.488 44.608-7.872 44.608-7.872l1.12-0.896 92.256-84 154.624 118.624 3.52 1.504c32.224 14.144 64.864 6.272 82.112-7.616 17.376-13.984 24.128-31.872 24.128-31.872l1.12-2.88 119.488-612.128c3.392-15.104 4.256-29.248 0.512-42.976a57.824 57.824 0 0 0-24.992-33.504 59.904 59.904 0 0 0-34.144-8.64z m-3.232 65.6c-0.128 2.016 0.256 1.792-0.64 5.664v0.352l-118.368 605.76c-0.512 0.864-1.376 2.752-3.744 4.64-2.496 1.984-4.48 3.232-14.88-0.896l-189.12-144.992-114.24 104.128 24-153.28 308.992-288c12.736-11.84 8.48-14.336 8.48-14.336 0.896-14.528-19.232-4.256-19.232-4.256l-389.632 241.376-0.128-0.64-186.752-62.88v-0.128l-0.48-0.096a8.64 8.64 0 0 0 0.96-0.384l1.024-0.512 0.992-0.352s166.752-70.272 336.256-141.632c84.864-35.744 170.368-71.744 236.128-99.52 65.76-27.616 114.368-47.872 117.12-48.96 2.624-1.024 1.376-1.024 3.264-1.024z"/>
  </svg>
</a>

    
    
    
    
    
    
    
    
      <a href="/atom.xml">
  <svg class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg">
    <path d="M122.88 720.213333a128 128 0 0 0 0 180.906667 128 128 0 0 0 180.906667 0 128 128 0 0 0-180.906667-180.906667z m120.746667 120.746667a42.666667 42.666667 0 0 1-60.586667-60.586667 42.666667 42.666667 0 0 1 60.586667 0 42.666667 42.666667 0 0 1 0 60.586667zM213.333333 512a42.666667 42.666667 0 0 0 0 85.333333 213.333333 213.333333 0 0 1 213.333334 213.333334 42.666667 42.666667 0 0 0 85.333333 0 298.666667 298.666667 0 0 0-298.666667-298.666667z m0-170.666667a42.666667 42.666667 0 0 0 0 85.333334 384 384 0 0 1 384 384 42.666667 42.666667 0 0 0 85.333334 0 472.746667 472.746667 0 0 0-137.386667-331.946667A472.746667 472.746667 0 0 0 213.333333 341.333333z m452.693334 16.64A644.693333 644.693333 0 0 0 213.333333 170.666667a42.666667 42.666667 0 0 0 0 85.333333 554.666667 554.666667 0 0 1 554.666667 554.666667 42.666667 42.666667 0 0 0 85.333333 0 644.693333 644.693333 0 0 0-187.306666-452.693334z"/>
  </svg>
</a>

    
  <p>
  <br>
  <p id="hitokoto">:D 获取中...</p>
  <script src="https://v1.hitokoto.cn/?c=a&encode=js&select=%23hitokoto" defer></script>
  <br>
  <p class="center font">
    &copy - <a href="https://kzcm.github.io/my-blog">kzcming</a> -  2020 -  2021 - Powered by <a target="_blank" rel="noopener" href="https://hexo.io/">Hexo</a>  Theme <a target="_blank" rel="noopener" href="https://github.com/pcrab/hexo-theme-quark"> Quark </a> 
  </p>
  <p>
    <a target="_blank" rel="noopener" href="http://www.beian.miit.gov.cn"></a>
  </p>
  <br/>
</foot>

</body>
</html>
